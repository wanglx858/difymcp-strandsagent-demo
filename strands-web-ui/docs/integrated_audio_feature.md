# 集成化音频转录功能使用指南

## 🎯 功能概述

全新的集成化音频转录功能现已集成到 Strands Web UI 的主聊天界面中，提供无缝的用户体验：

- **一键上传**: 通过 "📎 Attach Audio File" 按钮轻松上传 MP3 文件
- **智能处理**: 自动转录音频并与用户提示词结合
- **实时反馈**: 分步显示转录进度和结果
- **无缝集成**: 转录结果直接发送给 Strands Agent 处理

## 🚀 使用流程

### 步骤 1: 启动应用
```bash
cd /Users/fanjie/strands_web_ui
streamlit run app.py
```

### 步骤 2: 上传音频文件
1. 在主聊天界面点击 **"📎 Attach Audio File"** 按钮
2. 选择你的 MP3 音频文件
3. 配置语言检测选项（默认：英语和印尼语）
4. 选择 AWS 区域（默认：ap-southeast-1）
5. 点击 **"✅ Attach File"** 确认上传

### 步骤 3: 输入提示词并发送
1. 在聊天输入框中输入你的提示词或问题
2. 按 **Enter** 键发送

### 步骤 4: 查看处理结果
系统会自动执行以下步骤：
1. **Step 1/2**: 转录音频文件，显示检测语言和转录文本
2. **Step 2/2**: 将转录结果与用户提示词结合，发送给 AI Agent
3. 显示 Agent 的最终响应

## 🎨 用户界面特性

### 文件附件状态
- **已附加文件**: 显示蓝色信息框，包含文件名和说明
- **文件管理**: 提供 "🗑️ Remove" 和 "📎 Change File" 选项

### 转录结果显示
- **美观格式**: 使用卡片式布局显示转录结果
- **详细信息**: 显示检测语言、置信度、文件名
- **高亮文本**: 转录内容以引用格式突出显示

### 错误处理
- **友好提示**: 转录失败时显示清晰的错误信息
- **优雅降级**: 转录失败时自动使用纯文本输入继续处理

## 📝 使用示例

### 示例 1: 会议记录分析
1. **上传**: 会议录音 MP3 文件
2. **提示词**: "请总结这次会议的主要讨论点和决定事项"
3. **结果**: AI 会分析转录内容并提供结构化的会议总结

### 示例 2: 多语言客服对话
1. **上传**: 客服对话录音（印尼语/英语）
2. **提示词**: "请分析客户的问题并提供解决方案建议"
3. **结果**: AI 会根据检测到的语言分析对话内容

### 示例 3: 语音备忘录处理
1. **上传**: 个人语音备忘录
2. **提示词**: "请将这个语音备忘录整理成待办事项清单"
3. **结果**: AI 会将语音内容转换为有组织的任务列表

## ⚙️ 配置选项

### 语言检测
支持的语言选项：
- **en-US**: 英语（美国）
- **id-ID**: 印尼语（印度尼西亚）
- **zh-CN**: 中文（简体）
- **ja-JP**: 日语
- **ko-KR**: 韩语
- **th-TH**: 泰语
- **vi-VN**: 越南语

### AWS 区域
可选择的区域：
- **ap-southeast-1**: 亚太地区（新加坡）- 默认
- **us-east-1**: 美国东部（弗吉尼亚北部）
- **us-west-2**: 美国西部（俄勒冈）
- **eu-central-1**: 欧洲（法兰克福）

## 🔧 技术实现

### 处理流程
```
用户输入 + 音频文件
    ↓
音频转录 (AWS Transcribe)
    ↓
结果合并 (转录文本 + 用户提示词)
    ↓
Strands Agent 处理
    ↓
最终响应显示
```

### 数据流
1. **音频上传**: MP3 文件暂存在 session state
2. **格式转换**: MP3 → WAV (16kHz, 单声道, 16-bit)
3. **流式转录**: 使用 AWS Transcribe Streaming API
4. **结果合并**: 转录文本与用户提示词组合
5. **Agent 处理**: 发送给 Strands Agent 进行智能处理

## 🛠️ 故障排除

### 常见问题

**1. 转录失败**
- 检查 AWS 凭证配置
- 确认网络连接正常
- 验证音频文件格式（必须是 MP3）

**2. 语言检测不准确**
- 确保音频质量清晰
- 调整语言检测选项
- 尝试不同的 AWS 区域

**3. 文件上传问题**
- 检查文件大小（建议 < 100MB）
- 确认文件格式为 MP3
- 尝试重新上传

### 调试信息
- 转录过程的详细日志记录在控制台
- 错误信息会在 UI 中清晰显示
- 可以查看 `logs/output.log` 获取详细日志

## 🎯 最佳实践

### 音频质量
- **清晰录音**: 避免背景噪音
- **适当音量**: 确保语音清晰可听
- **单一语言**: 每个文件最好使用单一语言

### 提示词设计
- **具体明确**: 清楚说明你希望 AI 如何处理转录内容
- **上下文信息**: 提供必要的背景信息
- **任务导向**: 明确指定期望的输出格式

### 文件管理
- **合理大小**: 建议单个文件不超过 50MB
- **适当长度**: 5-30 分钟的音频效果最佳
- **及时清理**: 处理完成后及时移除附件

## 🔮 未来增强

计划中的功能改进：
- 支持更多音频格式（WAV, M4A, AAC）
- 批量文件处理
- 音频质量预检查
- 转录结果编辑功能
- 自定义语言模型支持

## 📞 技术支持

如果遇到问题，请：
1. 运行测试脚本：`python test_audio_integration.py`
2. 检查依赖安装：`pip install boto3 pydub amazon-transcribe`
3. 验证 AWS 配置：`aws configure list`
4. 查看应用日志：`logs/output.log`

---

**🎉 享受全新的集成化音频转录体验！**
